---
title: Configuració de la creació de factures automàtica
description: Aquest tema proporciona informació sobre com configurar la creació automàtica de factures proforma.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: ca-ES
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866769"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="a4d70-103">Configuració de la creació de factures automàtica</span><span class="sxs-lookup"><span data-stu-id="a4d70-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="a4d70-104">_**S'aplica a:** Implementació bàsica: tracte de facturació proforma, Project Operations per a escenaris basats en recursos/sense cotització_</span><span class="sxs-lookup"><span data-stu-id="a4d70-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="a4d70-105">Podeu configurar la creació de factures automàtica al Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="a4d70-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="a4d70-106">El sistema crea un esborrany de factura proforma basada en la planificació de factures per a cada contracte de projecte i línia de contracte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="a4d70-107">Les planificacions de factures es configuren al nivell de línia de contracte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="a4d70-108">Cada línia d'un contracte pot tenir una planificació de factures diferent, o la mateixa planificació de factures es pot incloure en cada línia del contracte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="a4d70-109">Quan es crea una factura, el sistema sempre crea com a mínim una factura per contracte de projecte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="a4d70-110">En alguns casos, es poden crear diverses factures.</span><span class="sxs-lookup"><span data-stu-id="a4d70-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="a4d70-111">Per exemple, si el contracte té diversos clients, es crearà el mateix nombre de factures que nombre de clients que tenen transaccions facturables per facturar en aquest contracte de projecte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="a4d70-112">Com s'inclouen les transaccions en una factura</span><span class="sxs-lookup"><span data-stu-id="a4d70-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="a4d70-113">De vegades, cada línia de contracte basada en projectes especifica una planificació de factures independent.</span><span class="sxs-lookup"><span data-stu-id="a4d70-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="a4d70-114">Per exemple, els serveis d'implementació del contracte d'Adatum tenen les següents línies de contracte:</span><span class="sxs-lookup"><span data-stu-id="a4d70-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="a4d70-115">Treball prototip que és un preu fix amb dues fites creades manualment.</span><span class="sxs-lookup"><span data-stu-id="a4d70-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="a4d70-116">Treball d'implementació que inclou temps i que es facturarà quinzenalment els dilluns.</span><span class="sxs-lookup"><span data-stu-id="a4d70-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="a4d70-117">Despeses incorregudes que s'han de facturar mensualment el primer dilluns de cada mes.</span><span class="sxs-lookup"><span data-stu-id="a4d70-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="a4d70-118">Les planificacions de factures definides en cadascun d'aquests dos elements de línia tenen un aspecte similar a la taula següent:</span><span class="sxs-lookup"><span data-stu-id="a4d70-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="a4d70-119">Línia de contracte</span><span class="sxs-lookup"><span data-stu-id="a4d70-119">Contract line</span></span> | <span data-ttu-id="a4d70-120">Data de creació de la factura</span><span class="sxs-lookup"><span data-stu-id="a4d70-120">Invoice run date</span></span> | <span data-ttu-id="a4d70-121">Data límit de la transacció</span><span class="sxs-lookup"><span data-stu-id="a4d70-121">Transaction cut-off date</span></span> | <span data-ttu-id="a4d70-122">Data de la fita</span><span class="sxs-lookup"><span data-stu-id="a4d70-122">Milestone date</span></span> | <span data-ttu-id="a4d70-123">Import de la fita</span><span class="sxs-lookup"><span data-stu-id="a4d70-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="a4d70-124">Treball prototip</span><span class="sxs-lookup"><span data-stu-id="a4d70-124">Prototype work</span></span> | <span data-ttu-id="a4d70-125">Dilluns 5 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-125">October 5, Monday</span></span> | - | <span data-ttu-id="a4d70-126">Dilluns 5 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-126">October 5, Monday</span></span> | <span data-ttu-id="a4d70-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="a4d70-127">5000 USD</span></span> |
| - | <span data-ttu-id="a4d70-128">Dimarts 3 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="a4d70-129">Dimarts 3 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-129">November 3, Tuesday</span></span> | <span data-ttu-id="a4d70-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="a4d70-130">12,000 USD</span></span> |
| <span data-ttu-id="a4d70-131">Treball d'implementació</span><span class="sxs-lookup"><span data-stu-id="a4d70-131">Implementation work</span></span> | <span data-ttu-id="a4d70-132">Dilluns 5 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-132">October 5, Monday</span></span> | <span data-ttu-id="a4d70-133">Diumenge 4 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="a4d70-134">Dilluns 19 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-134">October 19, Monday</span></span> | <span data-ttu-id="a4d70-135">Diumenge 18 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="a4d70-136">Dilluns 2 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-136">November 2, Monday</span></span> | <span data-ttu-id="a4d70-137">Dilluns 1 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="a4d70-138">Dilluns 16 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-138">November 16, Monday</span></span> | <span data-ttu-id="a4d70-139">Diumenge 15 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="a4d70-140">Despeses incorregudes</span><span class="sxs-lookup"><span data-stu-id="a4d70-140">Expenses incurred</span></span> | <span data-ttu-id="a4d70-141">Dilluns 5 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-141">October 5, Monday</span></span> | <span data-ttu-id="a4d70-142">Diumenge 4 d'octubre</span><span class="sxs-lookup"><span data-stu-id="a4d70-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="a4d70-143">Dilluns 2 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-143">November 2, Monday</span></span> | <span data-ttu-id="a4d70-144">Dilluns 1 de novembre</span><span class="sxs-lookup"><span data-stu-id="a4d70-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="a4d70-145">En aquest exemple, quan la facturació automàtica s'executa el dia:</span><span class="sxs-lookup"><span data-stu-id="a4d70-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="a4d70-146">**4 d'octubre o qualsevol data anterior**: no es genera cap factura per aquest contracte perquè la taula **Planificació de factures** per a cadascuna d'aquestes línies de contracte no té el diumenge 4 d'octubre com a data d'execució de la factura.</span><span class="sxs-lookup"><span data-stu-id="a4d70-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="a4d70-147">**Dilluns 5 d'octubre**: es genera una factura per a:</span><span class="sxs-lookup"><span data-stu-id="a4d70-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="a4d70-148">Treball prototip que inclou la fita, si es marca com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="a4d70-149">Treball d'implementació que inclou totes les transaccions de temps creades abans de la data límit de transaccions del diumenge 4 d'octubre, que estigui marcat com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="a4d70-150">Despeses incorregudes que inclouen totes les transaccions de despeses creades abans de la data límit de transaccions del diumenge 4 d'octubre, que estiguin marcades com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="a4d70-151">**6 d'octubre o qualsevol data abans del 19 d'octubre**: no es genera cap factura per a aquest contracte ja que la taula **Planificació de factures** per a cadascuna d'aquestes línies de contracte no té el 6 d'octubre ni cap data abans del 19 d'octubre com a data d'execució de la factura.</span><span class="sxs-lookup"><span data-stu-id="a4d70-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="a4d70-152">**Dilluns 19 d'octubre**: es genera una factura per al treball d'implementació que inclou totes les transaccions de temps creades abans de la data límit de transaccions del diumenge 18 d'octubre, que estigui marcat com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="a4d70-153">**Dilluns 2 de novembre**: es genera una factura per a:</span><span class="sxs-lookup"><span data-stu-id="a4d70-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="a4d70-154">Treball d'implementació que inclou totes les transaccions de temps creades abans de la data límit de transaccions del diumenge 1 de novembre, que estigui marcat com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="a4d70-155">Despeses incorregudes que inclouen totes les transaccions de despeses creades abans de la data límit de transaccions del diumenge 1 de novembre, que estiguin marcades com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="a4d70-156">**Dimarts 3 de novembre**: es genera una factura per al treball prototip que inclou la fita per 12.000 USD, si es marca com a **A punt per facturar**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="a4d70-157">Configurar la facturació automàtica</span><span class="sxs-lookup"><span data-stu-id="a4d70-157">Configure automatic invoicing</span></span>

<span data-ttu-id="a4d70-158">Completeu els passos següents per configurar una execució de factura automàtica.</span><span class="sxs-lookup"><span data-stu-id="a4d70-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="a4d70-159">Al **Projecte Operacions**, aneu a **Configuració** > **Configuració de la facturació recurrent**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="a4d70-160">Creeu un treball per lots i anomeneu-lo **Creació de factures del Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="a4d70-161">El nom del treball per lots ha d'incloure les paraules "Creació de factures".</span><span class="sxs-lookup"><span data-stu-id="a4d70-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="a4d70-162">Al camp **Tipus de treball**, seleccioneu **Cap**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="a4d70-163">Per defecte, els camps **Freqüència diària** i **Actiu** estan definides com a **Sí**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="a4d70-164">Seleccioneu **Executa el flux de treball**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-164">Select **Run Workflow**.</span></span> <span data-ttu-id="a4d70-165">Al quadre de diàleg **Registre de cerca**, veureu tres fluxos de treball:</span><span class="sxs-lookup"><span data-stu-id="a4d70-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="a4d70-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="a4d70-166">ProcessRunCaller</span></span>
- <span data-ttu-id="a4d70-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="a4d70-167">ProcessRunner</span></span>
- <span data-ttu-id="a4d70-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="a4d70-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="a4d70-169">Seleccioneu **ProcessRunCaller** i després trieu **Afegeix**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="a4d70-170">Al quadre de diàleg següent, seleccioneu **D'acord**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="a4d70-171">Un flux de treball **Repòs** va seguit d'un flux de treball **Procés**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="a4d70-172">També podeu seleccionar **ProcessRunner** al pas 5.</span><span class="sxs-lookup"><span data-stu-id="a4d70-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="a4d70-173">Després, quan seleccioneu **D'acord**, un flux de treball **Procés** va seguit d'un flux de treball **Repòs**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="a4d70-174">Els fluxos de treball **ProcessRunCaller** i **ProcessRunner** creen factures.</span><span class="sxs-lookup"><span data-stu-id="a4d70-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="a4d70-175">**ProcessRunCaller** crida a **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="a4d70-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="a4d70-176">**ProcessRunner** és el flux de treball que en realitat crea les factures.</span><span class="sxs-lookup"><span data-stu-id="a4d70-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="a4d70-177">El flux de treball passa per totes les línies de contracte per a les quals s'han de crear factures i crea factures d'aquestes línies.</span><span class="sxs-lookup"><span data-stu-id="a4d70-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="a4d70-178">Per determinar les línies de contracte per a les quals s'han de crear factures, el treball consulta les dates d'execució de la factura per a les línies de contracte.</span><span class="sxs-lookup"><span data-stu-id="a4d70-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="a4d70-179">Si les línies de contracte que pertanyen a un contracte tenen la mateixa data d'execució de la factura, les transaccions es combinen en una factura que té dues línies de factura.</span><span class="sxs-lookup"><span data-stu-id="a4d70-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="a4d70-180">Si no hi ha cap transacció per a la qual crear factures, el treball omet la creació de la factura.</span><span class="sxs-lookup"><span data-stu-id="a4d70-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="a4d70-181">Després d'haver acabat d'executar-se **ProcessRunner**, crida a **ProcessRunCaller**, proporciona l'hora d'acabament i es tanca.</span><span class="sxs-lookup"><span data-stu-id="a4d70-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="a4d70-182">**ProcessRunCaller** llavors inicia un temporitzador que s'executa durant 24 hores a partir de l'hora d'acabament especificada.</span><span class="sxs-lookup"><span data-stu-id="a4d70-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="a4d70-183">Al final del temporitzador, **ProcessRunCaller** es tanca.</span><span class="sxs-lookup"><span data-stu-id="a4d70-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="a4d70-184">El treball de processament per lots per crear factures és una feina recurrent.</span><span class="sxs-lookup"><span data-stu-id="a4d70-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="a4d70-185">Si aquest procés per lots s'executa moltes vegades, es creen diverses instàncies del treball que causen errors.</span><span class="sxs-lookup"><span data-stu-id="a4d70-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="a4d70-186">Per tant, hauríeu d'iniciar el procés de processament per lots només una vegada i reiniciar-lo només si s'atura l'execució.</span><span class="sxs-lookup"><span data-stu-id="a4d70-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="a4d70-187">La facturació per lots al Project Operations només s'executa per a les línies de contracte del projecte que es configuren mitjançant planificacions de factura.</span><span class="sxs-lookup"><span data-stu-id="a4d70-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="a4d70-188">Una línia de contracte amb un mètode de facturació de preu fix ha de tenir les fites configurades.</span><span class="sxs-lookup"><span data-stu-id="a4d70-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="a4d70-189">Una línia de contracte de projecte amb un mètode de facturació de temps i material necessitarà una configuració de planificació de facturació basada en la data.</span><span class="sxs-lookup"><span data-stu-id="a4d70-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
